{"filter":false,"title":"we.c","tooltip":"/we.c","undoManager":{"mark":1,"position":1,"stack":[[{"start":{"row":0,"column":0},"end":{"row":102,"column":54},"action":"insert","lines":["Skip to content","Personal Open source Business Explore","Sign upSign inPricingBlogSupport","This repository","Search"," Watch 14  Star 50  Fork 68 CoreData/cs50"," Code  Issues 0  Pull requests 0  Pulse  Graphs","Branch: master Find file Copy pathcs50/pset4/jpg/recover.c","0b63b0d  on 19 Jan 2013"," Chris Anders Fixed code for filename construction.","1 contributor","RawBlameHistory     90 lines (78 sloc)  1.91 KB","/****************************************************************************"," * recover.c"," *"," * Computer Science 50"," * Problem Set 4"," *"," * Recovers JPEGs from a forensic image."," ***************************************************************************/","#include <stdio.h>","#include <stdlib.h>","#include <stdint.h>","#include <string.h>","","int main(void)","{","\t\t// Open the cardfile, return if there's a problem with it","\t\tFILE* fp = fopen(\"card.raw\", \"r\");\t","","\t\tif(fp == NULL)","\t\t{\t","\t\t\t\tfclose(fp);","\t\t\t\tfprintf(stderr, \"Wasn't able to open the cardfile.\\n\");","\t\t\t\treturn 1;","\t\t}","","\t\t// These are the starting bytes of a jpeg file.","\t\tuint8_t checkjpg1[4] = {0xff, 0xd8, 0xff, 0xe0};","\t\tuint8_t checkjpg2[4] = {0xff, 0xd8, 0xff, 0xe1};","","\t\t// This keeps track of jpeg files found in the bytestream","\t\t// We use it to create filenames.","\t\tint jpgcount = 0;","","\t\t// Open outfile indicator","\t\tint open = 0;","\t\tFILE* outp;","","\t  // Read 512b blocks from file.","\t\tuint8_t buffer[512];","\t\tuint8_t check[4];","\t\tfread(buffer, 512, 1, fp);\t","","\t\twhile(fread(buffer, 512, 1, fp) > 0)","\t\t{","\t\t\t\t// Add first four bytes into the check buffer","\t\t\t\tfor(int i = 0; i < 4; i++)","\t\t\t\t{","\t\t\t\t\t\tcheck[i] = buffer[i];","\t\t\t\t}","","\t\t\t\t// Check for a jpeg signature","\t\t\t\tif((memcmp(checkjpg1, check, 4) == 0 ) || (memcmp(checkjpg2, check, sizeof(check)) == 0))","\t\t\t\t{","\t\t\t\t\t\t// Construct the filename","\t\t\t\t\t\tchar filename[8];","\t\t\t\t\t\tsprintf(filename, \"%03d.jpg\", jpgcount);","","\t\t\t\t\t\tif(open == 0)","\t\t\t\t\t\t{","\t\t\t\t\t\t\t\toutp = fopen(filename, \"w\");","\t\t\t\t\t\t\t\tfwrite(buffer, sizeof(buffer), 1, outp);","\t\t\t\t\t\t\t\topen = 1;","\t\t\t\t\t\t}","\t\t\t\t\t\tif(open == 1)","\t\t\t\t\t\t{","\t\t\t\t\t\t\t\tfclose(outp);","\t\t\t\t\t\t\t\toutp = fopen(filename, \"w\");","\t\t\t\t\t\t\t\tfwrite(buffer, sizeof(buffer), 1, outp);","\t\t\t\t\t\t\t\tjpgcount++;","\t\t\t\t\t\t}","\t\t\t\t}","\t\t\t\telse","\t\t\t\t{","\t\t\t\t\t\tif(open == 1)","\t\t\t\t\t\t{","\t\t\t\t\t\t\t\tfwrite(buffer, sizeof(buffer), 1, outp);","\t\t\t\t\t\t}","\t\t\t\t}","\t\t}","    ","\t\t// Close filehandles, be a good citizen and exit.","    if(outp)","    {","      fclose(outp);","    }","","\t\tfclose(fp);","\t\treturn 0;","}","Contact GitHub API Training Shop Blog About","© 2016 GitHub, Inc. Terms Privacy Security Status Help"],"id":1}],[{"start":{"row":101,"column":0},"end":{"row":102,"column":54},"action":"remove","lines":["Contact GitHub API Training Shop Blog About","© 2016 GitHub, Inc. Terms Privacy Security Status Help"],"id":2}]]},"ace":{"folds":[],"scrolltop":1118.545392036438,"scrollleft":0,"selection":{"start":{"row":101,"column":0},"end":{"row":101,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":81,"state":"start","mode":"ace/mode/c_cpp"}},"timestamp":1473890485334,"hash":"d0174dc057df105851ea55ad10737f95061585fa"}